# B站合集转收藏夹工具

🎯 一键将B站合集中的所有视频批量添加到你的收藏夹

## ✨ 功能特点

- 🚀 **批量转移**: 一次性将整个合集的所有视频添加到收藏夹
- 🔄 **智能重试**: 支持多种API端点，自动重试确保成功率
- 📊 **进度显示**: 实时显示转移进度和成功/失败统计
- 🛡️ **安全验证**: 内置cookies验证，确保账户安全
- 🔧 **调试模式**: 详细的错误信息和调试输出
- 📱 **多格式支持**: 支持多种B站合集URL格式

## 🔧 系统要求

- Python 3.6+
- requests 库
- 稳定的网络连接

## 📦 安装

### 1. 克隆项目
```bash
git clone [项目地址]
cd bilibili-collection-transfer
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 运行程序
```bash
python main.py
```

## 🚀 使用方法

### 方式一：自动管理cookies文件（推荐）

1. **首次运行**
   ```bash
   python main.py
   ```

2. **选择功能**
   ```
   请选择功能:
   1. 测试cookies是否有效
   2. 执行合集转收藏夹
   3. 创建/更新cookies文件
   4. 查看cookies文件状态
   ```

3. **创建cookies文件**
   - 选择选项3，程序会自动创建 `bilibili_cookies.txt` 文件
   - 按提示获取你的B站cookies并粘贴到文件中
   - 程序会自动验证cookies格式

4. **测试cookies**
   - 选择选项1测试cookies是否有效
   - 如果无效，可以选择选项3更新cookies

5. **执行转移**
   - 选择选项2执行合集转收藏夹操作
   - 程序会自动从文件读取cookies

### 方式二：手动创建cookies文件

1. **创建文件**: 在项目目录下创建 `bilibili_cookies.txt`
2. **获取cookies**: 
   - 登录B站 → F12开发者工具 → Console
   - 输入：`document.cookie`
   - 复制完整结果
3. **填入文件**: 将cookies粘贴到 `bilibili_cookies.txt` 中
4. **运行程序**: `python main.py`

## 📁 文件结构

```
bilibili-collection-transfer/
├── main.py                   # 主程序入口
├── FromListsToFavlist.py     # 核心功能类
├── bilibili_cookies.txt      # cookies配置文件（自动生成）
├── requirements.txt          # 依赖列表
├── README.md                # 说明文档
└── LICENSE                  # 许可证文件
```

## 📋 支持的URL格式

### 合集URL格式
- `https://space.bilibili.com/用户ID/lists/合集ID?type=season`
- `https://space.bilibili.com/用户ID/channel/seriesdetail?sid=合集ID`

### 收藏夹URL格式
- `https://space.bilibili.com/用户ID/favlist?fid=收藏夹ID&ftype=create`

## 🔍 示例使用

### 首次使用流程

```bash
$ python main.py

============================================================
B站合集转收藏夹工具
============================================================

请选择功能:
1. 测试cookies是否有效
2. 执行合集转收藏夹
3. 创建/更新cookies文件
4. 查看cookies文件状态

请输入选择 (1-4): 3

============================================================
创建Cookies文件
============================================================

将创建文件: bilibili_cookies.txt

🔧 获取cookies方法:
1. 登录B站 (https://www.bilibili.com)
2. 按F12打开开发者工具
3. 点击Console(控制台)标签
4. 输入: document.cookie
5. 复制返回的整个字符串

✅ 已创建文件: bilibili_cookies.txt

是否现在就输入cookies? (y/N): y

请粘贴你的cookies: [你的cookies]

✅ Cookies格式检查通过
✅ Cookies已保存到 bilibili_cookies.txt
```

### 测试cookies

```bash
$ python main.py

请输入选择 (1-4): 1

============================================================
B站Cookies测试工具
============================================================

✅ 从 bilibili_cookies.txt 读取到cookies
Cookies预览: SESSDATA=abc123def456...

🔍 检查cookies格式...
✅ Cookies格式检查通过

正在测试cookies...
API响应码: 0
API消息: 0
✅ 登录验证成功!
用户名: 你的用户名
UID: 12345678

🎉 Cookies有效！你可以使用主程序进行转移操作了。
```

### 执行转移操作

```bash
$ python main.py

请输入选择 (1-4): 2

============================================================
执行合集转收藏夹
============================================================

✅ 已从 bilibili_cookies.txt 读取cookies

1. 请输入合集URL: https://space.bilibili.com/627432065/lists/3836754?type=season

2. 请输入收藏夹URL: https://space.bilibili.com/309874814/favlist?fid=3125287314&ftype=create

即将执行操作:
源合集: https://space.bilibili.com/627432065/lists/3836754?type=season
目标收藏夹: https://space.bilibili.com/309874814/favlist?fid=3125287314&ftype=create

确认执行吗? (y/N): y

============================================================
正在验证登录状态...
✅ 登录验证成功!
用户名: 你的用户名
UID: 12345678
--------------------------------------------------
合集信息: 用户ID=627432065, 合集ID=3836754
收藏夹ID: 3125287314
--------------------------------------------------
正在获取合集 3836754 中的视频...
找到视频: 视频标题1 (BV1234567890)
找到视频: 视频标题2 (BV0987654321)
总共找到 25 个视频
--------------------------------------------------
开始将视频添加到收藏夹 3125287314...
[1/25] 成功添加: 视频标题1
[2/25] 成功添加: 视频标题2
[3/25] 添加失败: 视频标题3 - 已收藏
============================================================
操作完成!
成功转移 23 个视频到收藏夹
有 2 个视频转移失败
============================================================
```

## ⚠️ 注意事项

### 权限要求
- ✅ 只能添加到**你自己创建**的收藏夹
- ✅ 合集必须是**公开可访问**的
- ❌ 无法访问私有合集或他人的私有收藏夹

### 使用限制
- 🕐 脚本包含请求间隔，避免触发反爬虫限制
- 🔄 如果视频已在收藏夹中，会显示"添加失败"（这是正常的）
- 📶 确保网络连接稳定，大量视频转移需要时间

### 安全提醒
- 🔒 请勿分享你的cookies给他人
- ⏰ Cookies有时效性，过期后需要重新获取
- 🚫 遵守B站使用条款，适度使用

## 🐛 故障排除

### Cookies文件相关问题

#### 问题：文件不存在或读取失败
**解决方案：**
1. 运行程序选择选项3创建cookies文件
2. 确保 `bilibili_cookies.txt` 在程序同一目录下
3. 检查文件权限（确保可读写）

#### 问题：❌ 无法从文件读取有效cookies
**解决方案：**
1. 打开 `bilibili_cookies.txt` 检查内容
2. 确保cookies不是空的或只有注释
3. 重新获取并更新cookies（选项3）
4. 检查文件编码是否为UTF-8

### Cookies相关问题

#### 问题：❌ 登录验证失败
**解决方案：**
1. 确保已登录B站
2. 重新获取完整的cookies
3. 使用选项3更新cookies文件
4. 检查是否包含必要字段：`SESSDATA`、`DedeUserID`、`bili_jct`

#### 问题：cookies格式错误
**解决方案：**
- ✅ 正确格式：`SESSDATA=abc123; DedeUserID=12345; bili_jct=xyz789`
- ❌ 错误格式：`"SESSDATA=abc123"` (不要包含引号)
- ❌ 错误格式：包含换行符或特殊字符

### 文件管理技巧

#### 查看cookies状态
```bash
python main.py
# 选择选项4查看详细的cookies文件状态
```

#### 备份cookies
- 程序更新cookies时会自动备份旧文件为 `.backup`
- 可以手动复制 `bilibili_cookies.txt` 作为备份

#### cookies过期处理
1. 程序会提示cookies无效
2. 选择选项3重新获取并更新cookies
3. 旧cookies会自动备份

### API相关问题

#### 问题：获取合集视频失败
**解决方案：**
1. 检查合集URL是否正确
2. 确认合集是公开的
3. 合集可能是"视频列表"而非"合集"（脚本会自动尝试）

#### 问题：添加到收藏夹失败
**解决方案：**
1. 确认收藏夹URL正确
2. 确保是你自己的收藏夹
3. 检查收藏夹是否达到上限

### 网络相关问题

#### 问题：请求超时或连接失败
**解决方案：**
1. 检查网络连接
2. 尝试更换网络环境
3. 稍后重试（可能是服务器繁忙）

## 📊 输出示例

```
============================================================
正在验证登录状态...
✅ 登录验证成功!
用户名: 示例用户
UID: 12345678
--------------------------------------------------
合集信息: 用户ID=627432065, 合集ID=3836754
收藏夹ID: 3125287314
--------------------------------------------------
正在获取合集 3836754 中的视频...
找到视频: 视频标题1 (BV1234567890)
找到视频: 视频标题2 (BV0987654321)
...
总共找到 25 个视频
--------------------------------------------------
开始将视频添加到收藏夹 3125287314...
[1/25] 成功添加: 视频标题1
[2/25] 成功添加: 视频标题2
[3/25] 添加失败: 视频标题3 - 已收藏
...
============================================================
操作完成!
成功转移 23 个视频到收藏夹
有 2 个视频转移失败
============================================================
```

## 🔧 高级功能

### Cookies文件管理
- **自动创建**: 首次运行时自动引导创建cookies文件
- **格式验证**: 自动检查cookies是否包含必要字段
- **自动备份**: 更新cookies时自动备份旧文件
- **状态查看**: 详细显示cookies文件信息和有效性

### 调试模式
脚本包含详细的调试信息，如果遇到问题：
1. 查看控制台输出的错误信息
2. 检查API响应码和消息
3. 验证cookies中的关键字段
4. 使用选项4查看详细的文件状态

### 批量处理
- 支持大型合集（自动分页获取）
- 智能错误处理和重试机制
- 详细的进度反馈
- 多种API端点自动切换

### 便利功能
- **无需重复输入**: cookies保存在文件中，避免每次输入
- **智能提示**: 根据错误类型提供针对性解决方案
- **操作确认**: 执行敏感操作前需要用户确认
- **进度显示**: 实时显示转移进度和统计信息

## 📝 更新日志

### v2.0.0 (2025-05-27)
- 🎉 **重大更新**: 支持从文件读取cookies
- ✨ 新增cookies文件自动管理功能
- 🔧 增强的菜单系统（4个选项）
- 🛡️ 自动cookies格式验证和备份
- 📊 新增cookies文件状态查看功能
- 🚀 优化用户体验，无需重复输入cookies
- 📁 规范化文件结构和项目组织

### v1.0.0 (2025-05-24)
- ✨ 初始版本发布
- 🚀 支持合集到收藏夹的批量转移
- 🔧 添加cookies验证功能
- 📊 实现进度显示和错误处理
- 🛡️ 包含多种API端点支持

## 📄 许可证

本项目遵循 MIT 许可证，详见 [LICENSE](LICENSE) 文件。

## ⚖️ 免责声明

- 本工具仅供学习和个人使用
- 请遵守哔哩哔哩网站的使用条款
- 不得用于商业用途或大规模爬取
- 使用本工具造成的任何后果由用户自行承担

## 🤝 贡献

欢迎提交Issue和Pull Request！

如果这个工具对你有帮助，请给个⭐️ Star！

## 📞 联系方式

如有问题或建议，请：
1. 提交GitHub Issue
2. 检查[故障排除](#-故障排除)部分
3. 查看[注意事项](#️-注意事项)

---

**祝你使用愉快！ 🎉**